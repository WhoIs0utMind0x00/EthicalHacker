# 3.2.2 - Tipos de Análisis de Nmap
Las siguientes secciones cubren algunas de las opciones de escaneos de Nmap más comunes utilizadas para escenarios específicos, incluidas las siguientes:<br>
- Escaneo de conexión TCP (`-sT`)
- Escaneo de UDP (`-sU`)
- Escaneo FIN de TCP (`-sF`)
- Escaneos de detección de host (`-sn`)
- Opciones de tiempo (`-T 0-5`)<br>
<hr>

### Escaneo de conexión TCP (`-sT`)
Un escaneo de conexión TCP realmente utiliza el mecanismo de red del sistema operativo subyacente para establecer una conexión TCP completa con el dispositivo de destino que se está escaneando. Dado que crea una conexión completa, crea más tráfico (y, por lo tanto, tarda más en ejecutarse). Este es el tipo de escaneo predeterminado que se utiliza si no se especifica ningún tipo de escaneo con el comando `nmap`. Sin embargo, generalmente se debe usar solo cuando un escaneo SYN no es una opción, como cuando un usuario que ejecuta el comando `nmap` no tiene privilegios de paquetes sin procesar en el sistema operativo porque muchos de los tipos de escaneo de Nmap dependen sobre la escritura de paquetes sin procesar.<br>

#### _Respuestas de escaneo de conexión TCP_
| Estado del puerto     | Respuesta del Objetivo                                | Análisis de Nmap                              |
|-----------------------|-------------------------------------------------------|-----------------------------------------------|
| Abierto               | TCP SYN / ACK                                         | El servicio está escuchando en el puerto      |
| Cerrado               | TCP RST                                               | El servicio no está escuchando en el puerto   |
| Filtrado              | Sin respuesta del objetivo                            | El puerto está protegido con cortafuegos      |

#### _Ilustración de escaneo de conexión TCP_

<img src="img/tcp.jpeg" width="75%" height="75%" style="border-radius:10px;"><br>

#### _Salida de muestra de escaneo de conexión TCP_

```bash
    ┌──(root㉿Kali)-[~]
    └─# nmap -sT 192.168.88.251
    Starting Nmap 7.80 ( https://nmap.org ) at 2021-06-21 12:48 EDT
    Nmap scan report for 192.168.88.251
    Host is up (0.00024s latency).
    Not shown: 992 closed ports
    PORT     STATE SERVICE
    22/tcp   open  ssh
    80/tcp   open  http
    139/tcp  open  netbios-ssn
    445/tcp  open  microsoft-ds
    3306/tcp open  mysql
    8888/tcp open  sun-answerbook
    9000/tcp open  cslistener
    9090/tcp open  zeus-admin
    MAC Address: 1E:BD:4F:AA:C6:BA (Unknown)

    Nmap done: 1 IP address (1 host up) scanned in 0.16 seconds
```

Un escaneo de de conexión TCP completo requiere que el escáner envíe un paquete adicional por escaneo, lo que aumenta la cantidad de ruido en la red y puede activar alarmas que un escaneo medio abierto no activaría. Las herramientas de seguridad y el sistema objetivo subyacente tienen más probabilidades de registrar una conexión TCP completa, y los sistemas de detección de intrusiones (IDS) tienen más probabilidades de activar alarmas en varias conexiones TCP desde el mismo host.<br>
__CONSEJO__: Nmap escanea solo los 1000 puertos más comunes para cada protocolo. Puede especificar puertos adicionales para escanear mediante la opción `-p`. Puede obtener información adicional sobre las especificaciones del puerto y el orden de escaneo en _https://nmap.org/book/man-port-specification.html_. Omar Santos también ha creado una hoja de referencia de Nmap que incluye todas las opciones y está disponible en su repositorio de GitHub en *https://github.com/The-Art-of-Hacking/h4cker/blob/master/cheat_sheets/NMAP_cheat_sheet.md*.<br>

<hr>

### Escaneo UDP (`-sU`)
La mayoría de las veces, buscará puertos TCP, ya que así es como se conecta a la mayoría de los servicios que se ejecutan en los sistemas de destino. Sin embargo, puede encontrar algunos casos en los que deba buscar puertos UDP, por ejemplo, si está intentando enumerar un servidor DNS, SNMP o DHCP. Todos estos servicios utilizan UDP para la comunicación entre el cliente y el servidor. Para escanear puertos UDP, Nmap envía un paquete UDP a todos los puertos especificados en la configuración de la línea de comandos y espera noticias del objetivo. Si recibe un mensaje de puerto ICMP inaccesible de un destino, este puerto se marca como cerrado. Si no recibe respuesta del puerto UDP de destino, Nmap marca el puerto como abierto/filtrado.<br>
__NOTA__: Debe tener en cuenta que los mensajes ICMP inaccesibles a veces pueden tener una velocidad limitada y, cuando lo están, un escaneo de puerto UDP puede demorar mucho más. La limitación de velocidad de ICMP se utiliza principalmente para limitar el comportamiento de gusanos o virus y normalmente debe configurarse para permitir del 1% al 5% del ancho de banda entrante disponible (a velocidades de 10 Mbps o 100 Mbps) o de 100 kbps a 10,000 kbps (a velocidades de 1 Gbps o 10 Gbps) para utilizarse para el tráfico ICMP.<br>

#### _Respuestas de escaneo UDP_
| Estado del puerto     | Respuesta del Objetivo                                | Análisis de Nmap                                          |
|-----------------------|-------------------------------------------------------|-----------------------------------------------------------|
| Abierto               | Datos devueltos por el puerto                         | El servicio está escuchando en el puerto                  |
| Cerrado               | Mensaje de error de ICMP recibido                     | El servicio no está escuchando en el puerto               |
| Filtrado              | Sin respuesta de ICMP del objetivo                    | El puerto tiene cortafuegos o se venció el tiempo         |

#### _Ilustración de escaneo UDP_
<img src="img/udp.jpeg" width="75%" height="75%" style="border-radius:10px;"><br>

#### _Salida de muestra de escaneo UDP_
```bash
    ┌──(root㉿Kali)-[~]
    └─# nmap -sU -p 53 192.168.88.251
    Starting Nmap 7.80 ( https://nmap.org ) at 2021-06-21 13:12 EDT
    Nmap scan report for 192.168.88.251
    Host is up (0.00057s latency).
    PORT   STATE  SERVICE
    53/udp open domain
    MAC Address: 1E:BD:4F:AA:C6:BA (Unknown)
    Nmap done: 1 IP address (1 host up) scanned in 0.19 seconds                                 
```
<hr>

### Escaneo TCP FIN (`-sF`)
Hay momentos en los que un filtro de red o cortafuegos puede detectar un escaneo de sincronización. En tal caso, debe emplear un tipo diferente de paquete en un escaneo de puertos. Con el escaneo TCP FIN, se envía un paquete FIN a un puerto de destino. Si el puerto está realmente cerrado, el sistema devuelve un paquete RST. Si no recibe nada del puerto de destino, puede considerar el puerto abierto porque el comportamiento normal sería ignorar el paquete FIN.<br>
__NOTA__: Un escaneo TCP FIN no es útil cuando se analizan sistemas basados en Windows, ya que responden con paquetes RST, independientemente del estado del puerto.<br>

#### _Respuestas de escaneo TCP FIN_
| Estado del puerto     | Respuesta del Objetivo                                | Análisis de Nmap                                          |
|-----------------------|-------------------------------------------------------|-----------------------------------------------------------|
| Filtrado              | Se recibió un error de ICMP inalcanzable              | El puerto cerrado debe responder con RST                  |
| Cerrado               | Paquete RST recibido                                  | El puerto cerrado debe responder con RST                  |
| Abierto/Filtrado      | No se recibió respuesta                               | El puerto abierto debe descartar el FIN                   |

#### _Ilustración de escaneo TCP FIN_
<img src="img/fin.jpeg" width="75%" height="75%" style="border-radius:10px;"><br>

#### _Salida de muestra de escaneo TCP FIN_
```bash
    ┌──(root㉿Kali)-[~]
    └─# nmap -sF -p 80 192.168.88.251
    Starting Nmap 7.80 ( https://nmap.org ) at 2021-06-21 13:15 EDT
    Nmap scan report for 192.168.88.251
    Host is up (0.00045s latency).
    PORT    STATE           SERVICE
    80/tcp open|filtered http
    MAC Address: 1E:BD:4F:AA:C6:BA (Unknown)
    Nmap done: 1 IP address (1 host up) scanned in 0.38 seconds
```
<hr>

### Escaneo de detección de host (`-sn`)
Un escaneo de detección de host es uno de los tipos más comunes de escaneos utilizados para enumerar hosts en una red porque puede usar diferentes tipos de mensajes ICMP para determinar si un host está en línea y responde en una red.<br>
__NOTA__: El valor predeterminado para la opción de escaneo `-sn` es enviar un paquete de solicitud de eco ICMP al destino, un TCP SYN al puerto 443, un TCP ACK al puerto 80 y una solicitud de marca de tiempo ICMP. Esto está documentado en _https://nmap.org/book/man-host-discovery.html_. Si el objetivo responde al eco de ICMP o a los paquetes mencionados anteriormente, se considera activo.<br>

#### _Escaneo de detección de host_
```bash
    ┌──(root㉿Kali)-[~]
    └─# nmap -sn 192.168.88.0/24
    Starting Nmap 7.80 ( https://nmap.org ) at 2021-06-21 14:32 EDT
    Nmap scan report for 192.168.88.1
    Host is up (0.00045s latency).
    MAC Address: E0:55:3D:E9:61:74 (Cisco Meraki)
    Nmap scan report for 192.168.88.12
    Host is up (0.00094s latency).
    MAC Address: 0E:64:AF:27:9C:44 (Unknown)
    Nmap scan report for 192.168.88.14
    Host is up (0.0092s latency).
    MAC Address: 00:B8:B3:FD:BF:C2 (Cisco Systems)
    Nmap scan report for 192.168.88.24
    Host is up (0.0033s latency).
    MAC Address: 00:E1:6D:E5:43:C2 (Cisco Systems)
    Nmap scan report for 192.168.88.32
    Host is up (0.00046s latency).
    MAC Address: BE:38:F5:2D:6C:C0 (Unknown)
    Nmap scan report for 192.168.88.231
    Host is up (0.00061s latency).
    MAC Address: FE:82:8C:A3:D2:3C (Unknown)
    Nmap scan report for 192.168.88.251
    Host is up (0.00040s latency).
    MAC Address: 1E:BD:4F:AA:C6:BA (Unknown)
    Nmap scan report for 192.168.88.71
    Host is up.
    Nmap scan report for 192.168.88.225
    Host is up.
    Nmap done: 256 IP addresses (11 hosts up) scanned in 2.45 seconds
```

### Opciones de Sincronización
El escáner de Nmap proporciona seis plantillas de temporización que se pueden especificar con la opción `-T` y el número de plantilla (de 0 a 5) o el nombre. Las plantillas de sincronización de Nmap le permiten determinar cuán agresivo será un escaneo, mientras deja que Nmap elija los valores de sincronización exactos. Estas son las opciones de tiempo:<br>
- __`-T0` (`Paranoid`)__: Muy lento, se usa para la evasión de IDS.
- __`-T1` (`Sneaky`)__: Bastante lento, se usa para la evasión de IDS.
- __`-T2` (`Polite`)__: Se ralentiza para consumir menos ancho de banda, se ejecuta aproximadamente 10 veces más lento que el valor predeterminado.
- __`-T3` (`Normal`)__: Predeterminado, un modelo de tiempo dinámico basado en la capacidad de respuesta del objetivo.
- __`-T4` (`Aggresive`)__: Supone una red rápida y confiable y puede abrumar los objetivos.
- __`-T5` (`Insane`)__: Muy agresivo; probablemente abrumará a los objetivos o perderá los puertos abiertos.<br>
