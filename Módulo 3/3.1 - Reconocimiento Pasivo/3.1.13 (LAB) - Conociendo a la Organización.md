# 3.1.13 - Práctica de Laboratorio: Conociendo más sobre la Organización

## Objetivos
En esta práctica de laboratorio se cumplirán los siguientes objetivos:<br>
- Encuentre información sobre violaciones de correo electrónico.
- Vea los metadatos del archivo.

## Trasfondo / Escenario
El propósito del reconocimiento en la prueba de penetración es recopilar información sobre un cliente que se puede usar más adelante para su explotación. Hay muchos recursos que ayudan con este proceso. En esta práctica de laboratorio, aprenderá sobre recursos en línea que pueden proporcionar información sobre una empresa.<br>

## Recursos Necesarios
- Máquina Virtual Kali Linux
- Acceso a Internet

## Parte 1: Encuentre información sobre violaciones de correo electrónico
Es posible obtener más información sobre una persona u organización mediante la búsqueda en una dirección de correo electrónico conocida. Es útil determinar si los empleados de una empresa han visto comprometidas sus direcciones de correo electrónico de trabajo. Varios servicios en línea brindan la capacidad de buscar en direcciones de correo electrónico individuales y dominios completos para revelar violaciones. Algunos de estos sitios son:<br>
- _haveibeenpwned.com_
- _f-secure.com_
- _hacknotice.com_
- _breachdirectory.com_
- _keepersecurity.com_<br>

### Paso 1: Investigue el estado de su correo electrónico
Explore los diferentes sitios y busque su propia dirección de correo electrónico o el dominio de una empresa que conozca. Es especialmente preocupante si se ha producido una violación de datos reciente para un dominio. También es posible que un cliente de pruebas de penetración no tenga conocimiento de la violación.<br>
Existen recursos que permitirán el acceso a estos archivos de violación de datos. Desde allí, puede encontrar nombres de usuario, direcciones de correo electrónico, contraseñas y otra información sobre los empleados. Esta información será muy útil en la parte de explotación del proceso de pruebas de penetración.<br>

### Paso 2: Use una herramienta para buscar direcciones de correo electrónico para un dominio
Utilizará una herramienta llamada __EmailHarvester__ para encontrar información sobre un dominio, incluidas las direcciones de correo electrónico del personal.<br>
<hr>

- Abra una terminal e ingrese el comando `emailharvester`. La herramienta aún no se ha instalado en Kali, pero es parte de su conjunto de herramientas. Ingrese `y` para aceptar la instalación de la herramienta y proporcione la contraseña para el usuario si se le solicita.<br>
- Una vez completada la instalación, use la opción `-h` para ver las opciones disponibles en la herramienta.
- En este caso, usaremos la opción `-d` para escanear un dominio.<br>
- Investigue dominios como _h4cker.org_, _hackxor.net_ y _scanme.nmap.org_. También puede probar otros dominios con los que esté familiarizado, siempre que no infrinja los términos de este curso. Por ejemplo, use el comando `emailharvester -d h4cker.org`.
- Verifique algunas de las direcciones de correo electrónico que obtuvo para determinar si han sido parte de una violación de datos. Si es así, esto indica que los detalles de la cuenta están disponibles en la dark web. Un evaluador de penetración que tenga acceso a bases de datos de intrusiones podría buscar información adicional allí.<br>
- Los resultados pueden enviarse a un archivo que otras herramientas pueden utilizar como lista de entrada. Utilice la opción `-s` para especificar un nombre de archivo. EmailHarvester crea archivos XML y de texto. Proporcione una ruta si lo desea. De lo contrario, los archivos se almacenarán en la carpeta `/user/share/emailharvester`. Inspeccione el contenido de los archivos.<br>

### Paso 3: Utilice Spiderfoot para investigar las direcciones de correo electrónico
- Inicie la GUI de Spiderfoot:<br>

```bash
    ┌──(kali㉿Kali)-[~]
    └─$ spiderfoot -l 127.0.0.1:5001
```
- Minimice la terminal.
- Abra la GUI de Spiderfoot en su navegador con la dirección IP y el puerto asignados anteriormente.
- Haga clic en el elemento de menú __Settings__ e investigue los módulos disponibles.<br>Lea las descripciones de los módulos e investigue los requisitos de la API, si corresponde. Opcionalmente, regístrese para obtener algunas de las claves de API gratuitas. Configure los módulos con las claves.<br>

Busqué módulos que sean útiles para realiar escaneo de correo electrónico. Por ejemplo, le gustaría saber si la dirección es parte de una violación, qué cuentas están registradas en la dirección en sitios de medios sociales y repositorios de códigos, uso compartido de enlaces y foros técnicos. Tome notas de sus hallazgos.<br>
Algunos módulos interesantes son:<br>
__Ahmia__<br>__AccountFinder__<br>__Archive.org__<br>__Bing__<br>__LeakLookup__<br>__CommonCrawl__<br>__Dehashed__<br>__DuckDuckGo__<br>__EmailCrawlr__<br>

- Intente ejecutar un nuevo escaneo una dirección de correo electrónico interesante seleccionando los módulos interesantes en la fiche `New Scan` > `By Module`.
- Después de realizar las selecciones y proporcionar el nombre y el destino del escaneo, desplácese hasta la parte inferior de la página y haga clic en `Run Scan Now`.<br>

## Parte 2: Ver metadatos del archivo
Los metadatos de archivos pueden proporcionar información sobre las organizaciones y el personal a los hackers. Por ejemplo, los metadatos dentro de un archivo de imagen pueden revelar el dispositivo que se utilizó para crear la imagen. Esto puede revelar información que puede utilizarse para determinar si el dispositivo es potencialmente vulnerable. Algunos archivos tienen metadatos que consisten en comentarios, el nombre del autor, los nombres de usuari, el sistema operativo o la ubicación en la que se creó el archivo. Los metadatos varían según el tipo de archivo y el dispositivo en el que se crearon. Los hackers pueden utilizar esta información para armar un medio de ataque.<br>
En general, los metadatos de los archivos que se publican en la Internet pública deben eliminarse o al menos analizarse. Puede utilizar __Exiftool__, entre otros, para eliminar o editar etiquetas de archivos individuales o un directorio de archivos.<br>
Exiftool viene en una versión GUI que está disponible para Windows, MacOS y Linux.<br>

### Paso 1: Instale ExifTool
- En Firefox, haga clic en el acceso directo __Kali Tools__ o vaya a _https://www.kali.org/tools_.
- Seleccione `List all tools` según sea necesario. Busque la entrada `libimage-exiftool-perl`.
- Siga las instrucciones de instalación.
- Exiftool hace referencia a los atributos de metarchivo como etiquetas. Utilice la opción `-list` para ver todas las etiquetas que ExifTool puede procesar.
- Emita el comando `exiftool -listf` para revisar los tipos de archivo que ExifTool puede analizar.<br>

ExifTool puede leer metadatos de una amplia gama de archivos. Revise la siguiente tabla:<br>

|       Tipo        |           Extensión                           |
|-------------------|-----------------------------------------------|
| Documentos        | PDF, TXT, DOCM, DOCX, HTML                    |
| Audio             | FLAC, MP3, WAV, AIFF, RA, WMA                 |
| Video             | AVI, DV, FLV, MOV, QT, MP4, MPEG, WEBMV, WMV  |
| Gráficos          | BMP, EXIF, GIF, JPEG, JPG, PNG, SVG, TIFF     |
| Archivos          | GZ, GZIP, RAR, ZIP                            |

### Paso 2: Utilice ExifTool
Necesitará algunos archivos que podrá utilizar para explorar los metadatos con la herramienta. Puede hacerlo con archivos que tenga en su PC o, mejor aún, archivos que pueda encontrar abiertamente disponibles en línea.<br>
- Vaya a la Base de Datos de Google Hacking (GHDB). Busque dorks que le ayudarán a encontrar una variedad de archivos de varios tipos o modificar los dorks que encuentre para hacerlo.
- Descargue los archivos a su VM. Tome nota de la ruta de la carpeta.
- Experimente con ExifTools. Comience simplemente ejecutando el comando `exiftool` seguido de la ruta y el nombre del archivo de destino. Revise los metadatos devueltos. Haga esto para varios archivos.<br>
- Ahora, intente ejecutar ExifTool para toda la carpeta. Para ello, solo proporciona la ruta.
- Puede guardar los metadatos de cada imagen en la carpeta o de imagenes individuales agregando la opción `-csv`. Por ejemplo:<br>

```bash
    ┌──(kali㉿Kali)-[~]
    └─$ exiftool -csv > /path/to/out.csv [Archivo/Carpeta]
```
- En Internet, busque algunos de los valores que encuentre en el archivo. Por ejemplo, la etiqueta `CREATOR: gd-jpeg v1.0` indica que la imagen fue generada por la biblioteca PHP GD versión 1.0. Esta versión contiene una vulnerabilidad donde el código es capaz de leer datos más allá de los límites del búfer.<br>
