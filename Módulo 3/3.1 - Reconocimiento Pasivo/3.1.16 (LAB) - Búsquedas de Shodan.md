# 3.1.16 - Práctica de Laboratorio: Búsquedas de Shodan

## Objetivos
Shodan es un motor de búsqueda para dispositivos de IoT desarrollado por John Matherly en 2009. Shodan puede descubrir todo tipo de cosas conectadas a Internet, desde teléfonos móviles hasta dispositivos inteligentes y plantas de energía. Es una herramienta poderosa para determinar qué dispositivos están conectados actualmente a la red y cómo se conectan.<br>
- Cree una cuenta de usuario de Shodan y regístrese para obtener una clave de API
- Utilice el sitio web de Shodan para buscar dispositivos de IoT vulnerables
- Usar la CLI de Shodan para realizar una búsqueda.<br>

## Trasfondo / Escenario
Los dispositivos de IoT se utilizan ampliamente. Los crean, instalan y mantienen los gobiernos, las empresas y los propietarios de viviendas. Estos dispositivos no suelen estar protegidos por el fabricante. Es responsabilidad del usuario final garantizar que estos dispositivos no introduzcan riesgos adicionales para la seguridad de la red.<br>
Puede realizar algunas búsquedas en Shodan sin obtener una suscripción. Las búsquedas más extensas requieren una suscripción de paga.<br>

En esta práctica de laboratorio, realizará una búsqueda en Shodan de dispositivos vulnerables dentro de su red privada, así como dentro de un rango definido de direcciones IP. Como con la mayoría de las herramientas que está utilizando en este curso, solo escanee o acceda a las redes que posee o tiene permiso de acceso.<br>

## Recursos Necesarios
- Máquina Virtual Kali Linux
- Acceso a Internet<br>

## Parte 1: Cree una cuenta de Shodan y regístrese para obtener una clave de API

### Paso 1: Regístrese para obtener una cuenta de Shodan
- Inicie sesión en su VM Kali Linux
- Abra el navegador Firefox y vaya a _https://www.shodan.io/_.
- Haga clic en el botón `Login` en la parte superior derecha. En la siguiente pantalla, haga clic en el botón `Register` de la barra de menús. Complete su información para crear una cuenta de Shodan. Recibirá un correo electrónico para activar su cuenta.
- Cuando se complete su registro, inicie sesión en su cuenta de Shodan. Esta es una cuenta gratuita que tiene varias restricciones, incluida la cantidad de resultados que se mostrarán de cada búsqueda. Inicie sesión y vaya a la página de inicio de Shodan. Revise la sección `Getting Started`, especialmente el enlace `Search Query Fundamentals`, donde se identifica al banner como la unidad fundamental de datos.<br>

## Parte 2: Usar el sitio web de Shodan para buscar dispositivos de IoT vulnerables

### Paso 1: Usar la barra de búsqueda de Shodan para detectar dispositivos de IoT
- En la página de inicio de Shodan, ingrese __webcam__ en la barra de búsqueda cerca de la parte superior de la pantalla y presione Enter.
- Aparecerá una página que muestra los resultados de la búsqueda. En el lado izquierdo de la pantalla hay estadísticas de resumen. Las estadísticas muestran la cantidad total de banners de dispositivos que incluyen el término "__webcam__", los principales países donde se encontraron los resultados, las principales organizaciones, los principales productos y los principales sistemas operativos. Puede ver hasta 10 resultados sin un inicio de sesión de Shodan. Los usuarios registrados pueden acceder a 50 resultados de forma gratuita. Los servicios adicionales están disponibles con una suscripción de paga.<br>En esta búsqueda, nos muestra que el principal país con webcams encontrado es Estados Unidos.
- Haga clic en una de las direcciones IP que aparecen en los resultados de la búsqueda. Se abre una página con información más detallada. En la parte superior de la página, hay un mapa que muestra la ubicación aproximada del resultado de la búsqueda que seleccionó.<br>En la sección `Información General` nos muestra el __nombre del host__, __dominios__, __país__ y la __ciudad__.
- En el lado derecho de la salida hay una lista de puertos abiertos que Shodan encontró en el dispositivo. En este caso específico, mostró los puertos __8081__, __8080__ y __443__. La información disponible para los puertos abiertos son encabezados, páginas web y certificados.<br>

__NOTA__: No todos los dispositivos descubiertos son en realidad cámaras web. Son dispositivos que tiene la palabra "webcam" en algún lugar de su banner de servicio.<br>

- Busque en Internet "_Fabricantes de cámaras web vulnerables_". Con frecuencia, los banners del dispositivo nombrarán al fabricante del dispositivo. Intente buscar algunos nombres de fabricantes en Shodan. A partir de los resultados, puede definir mejor los resultados de la búsqueda, a veces con números de modelo específicos del fabricante. Además, busque los inicios de sesión predeterminados utilizados por el modelo de la cámara. Es posible que el propietario de la cámara no haya cambiado la contraseña predeterminada. __NO__ intente iniciar sesión en dispositivos que ahora posee o tiene permiso de acceso.<br>

### Paso 2: Utilice filtros de Shodan para refinar los resultados
Shodan proporciona un método para filtrar los resultados de la búsqueda mediante la sintaxis _`filtro:valor`_ sin espacios. Si el valor contiene espacios, como `city"los angeles"`, debe encerrar el valor entre comillas dobles. Algunos de los filtros de búsqueda más populares son:<br>
- `country:XX`: Busca por país basándose en su código de 2 dígitos
- `city:nombre-de-ciudad`: Busca por una ciudad específica
- `region:region-o-estado`: Busca por región o estado específico
- `version`: Busca una versión específica de un producto
- `vuln:XX`: Busca vulnerabilidades que coincidan con un número específico de CVE<br>

- Introduzca un filtro en la barra de búsqueda de Shodan. Este ejemplo devuelve todos los dispositivos con "__webcam__" en un banner que Shodan encuentra en la ciudad de Toronto:<br>
```
    webcam city:Toronto
```
- Un problema de configuración común que se encuentra en Internet son los servidores FTP que permiten inicios de sesión anónimos.<br>Utilice la cadena de búsqueda para encontrar los servidores FTP en San José, California.<br>
```
    port:21 country:US region:CA city:"San Jose" 230
```
Esta búsqueda utiliza el puerto FTP TCP 21 estándar, con filtros de ubicación y una búsqueda de texto para 230. 230 es el código de respuesta de inicio de sesión correcto de FTP.<br>En este caso específico, Shodan encontró 441 servidores FTP que permiten inicios de sesión anónimos.<br>
- Las búsquedas de Shodan pueden identificar aplicaciones en la nube y posibles honeypots. Explore los resultados de la búsqueda de sus consultas para encontrar los resultados etiquetados con __cloud__ o __honeypot__.
- Haga clic en uno de los resultados etiquetados con __cloud__ para abrir la página de detalles.
- En esta página, nos muestra información adicional como el __proveedor de la nube__, la __región de la nube__ y el __servicio en la nube__.<br>

### Paso 3: Utilice Shodan para buscar un producto o servicio específico
Puede utilizar Shodan para buscar un producto específico, como servidores Apache abiertos en el puerto 80. Formule una consulta para encontrar los servidores Apache en su ciudad.<br>
```
    Apache port:80 city"tu-ciudad"
```

## Parte 3: Utilice la CLI de Shodan para realizar una búsqueda

### Paso 1: Inicialice Shodan y realice una búsqueda
- Busque y copie su clave de API seleccionando `Account` > `Overview` en la parte superior derecha de la pantalla del sitio web de Shodan. La clave de API se muestra sobre el código QR.
- Shodan es una biblioteca de Python que se instala en Kali de manera predeterminada. Abra una ventana de terminal.
- En el indicador, ingrese el comando `shodan init` y presione `Ctrl + Shift + V` para pegar la clave API en el terminal. Su clave API debe aparecer al final del comando.<br>

```bash
    ┌──(root㉿kali)-[/home/kali]
    └─$ shodan init [Clave-API]
```

Este comando debe devolver la cadena "__Successfully initialized__".<br>
- Introduzca el comando `shodan -h` para mostrar la lista de comandos de Shodan disponibles.
- Realice la misma búsqueda que realizó anteriormente, pero ahora en la CLI para ver las cámaras web que encuentra Shodan. En la CLI debe ingresar el comando `shodan search` antes de especificar los criterios de búsqueda.<br>

```bash
    ┌──(kali㉿kali)-[~]
    └─$ shodan search webcam
```

El resultado del comando es texto sin formato. Las direcciones IP de los dispositivos que encuentra Shodan se resaltan junto con el puerto y el nombre del dispositivo. Presione `q` para salir y volver al indicador de la CLI. Los comandos de la CLI de Shodan se pueden escribir en scripts de Python para automatizar las funciones de búsqueda y escaneo.<br>
__NOTA__: La búsqueda con filtros no está disponible con una clave de API gratuita.

### Paso 2: Ejecute otros comandos de la CLI de Shodan
No todos los comandos enumerados están disponibles en la versión gratuita de Shodan. El comando `shodan info` mostrará cuántos créditos tiene actualmente para realizar búsquedas o escaneos.<br>

```bash
    ┌──(kali㉿kali)-[~]
    └─$ shodan info
    Query credits available: 0
    Scan credits available: 0
```

Para las suscripciones de paga, los créditos disponibles se restablecerán cada mes. Hay suscripciones disponibles que permiten consultas y escaneos ilimitados.<br>
- Utilice el comando `shodan myip` para encontrar la dirección IP registrada que corresponde a su dispositivo.<br>La dirección IP devuelta es la dirección IP de origen que se agregará a cualquier paquete enviado desde su dispositivo a un destino en Internet.
- Otro comando útil es el comando `stats`. Devolverá la información de resumen sobre una consulta, similar a la que se muestra en la página de resultados en la versión web. Para obtener la información de resumen, ingrese el comando de estadísticas y la consulta de búsqueda de la cuál desea ver los resultados.<br>

```bash
    ┌──(kali㉿kali)-[~]
    └─$ shodan stats webcam
```
Esta consulta devuelve las estadísticas de resumen de la búsqueda de "webcam".