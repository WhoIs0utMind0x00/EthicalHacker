# Práctica de Laboratorio - Uso de Herramientas de Contraseñas

## Objetivos
- Parte 1: Investigar los ataques a contraseñas
- Parte 2: Descifrar hashes con ataques de diccionario de Hashcat
- Parte 3: Descifrar hashes con John the Ripper mediante diccionario y ataques de fuerza bruta
- Parte 4: Descifrar hashes con RainbowCrack y tablas arcoíris.<br>

## Trasfondo / Escenario
Las contraseñas son vulnerables a los ataques. Las contraseñas generalmente se almacenan como hashes cifrados. Un atacante puede capturar los hashes enviados a través de la red mediante herramientas de rastreo o puede obtener acceso a los archivos que contienen hashes de contraseñas en sistemas vulnerables. Cuando el atacante tiene los hashes, puede aplicar ataques de diccionario, tablas arcoíris y fuerza bruta contra ellos fuera de línea para descifrar el hash y recuperar las contraseñas en texto plano. Hay muchas herramientas de ataque de contraseñas incluidas con Kali Linux. En esta práctica de laboratorio, se analizarán tres herramientas populares: Hashcat, John the Ripper y RainbowCrack.<br>

## Recursos necesarios
- Máquina Kali
- Acceso a Internet

## Parte 1: Investigue los ataques a contraseñas
__Paso 1: Inicie sesión en Kali Linux y verifique el entorno__<br>
- Seleccione __Applications > Password Attacks__<br>

__Paso 2: Examine las herramientas de ataque a contraseñas disponibles__<br>
- Haga clic en cada subcategoría de ataque y revise las herramientas de ataque disponibles.
- Pase el cursor sobre cada herramienta. Tenga en cuenta que algunas herramientas tienen un cuadro de texto emergente que contiene una breve descripción de la herramienta. También puede buscar las herramientas en la página Herramientas de Kali para obtener información sobre ellas y lo que hacen.<br>

## Parte 2: Descifrado de hashes con ataques de diccionario de Hashcat
__Paso 1: Cree un archivo que contenga hashes MD5 para descifrarlo__<br>
Primero, se necesitan algunos hashes de contraseñas MD5. En un ataque real, un atacante ya habrá comprometido un sistema vulnerable para obtener un archivo de contraseñas que contiene hashes de contraseñas almacenados para descifrarlos sin conexión. En este paso, puede simular esto creando un archivo de contraseña que contiene los hash que descifrará en un próximo paso.<br>
- En una ventana de terminal, cree cinco hashes de destino ingresando los siguientes comandos en el indicador:<br>

```bash
    echo -n 'Password' | md5sum | awk '{ print $1 }' > my_pw_hashes.txt
    echo -n 'Password123' | md5sum | awk '{ print $1 }' >> my_pw_hashes.txt
    echo -n 'Letmein!' | md5sum | awk '{ print $1 }' >> my_pw_hashes.txt
    echo -n 'ilovedogs' | md5sum | awk '{ print $1 }' >> my_pw_hashes.txt
    echo -n '1234abcd' | md5sum | awk '{ print $1 }' >> my_pw_hashes.txt
```

Tenga en cuenta que las contraseñas varían en complejidad.<br>
Los hashes generados se escriben en el archivo **my_pw_hashes.txt**.<br>
- Luego, verifique los hashes de contraseña que acaba de crear ingresando el comando __cat__.
- El resultado es este:<br>

```bash
    ┌──(kali㉿Kali)-[~]
    └─$ cat my_pw_hashes.txt
    dc647eb65e6711e155375218212b3964
    42f749ade7f9e195bf475f37a44cafcb
    e85a3b267e94f3721117fc7ac54fbeba
    33830b8b7fd414b12c208c4de5055464
    ef73781effc5774100f87fe2f437a435
```

__Paso 2: Inicie Hashcat en Kali__<br>
- Abra un nuevo terminal Kali e ingrese el comando __man hashcat__<br>
- Esto abre el manual de Hashcat, puede revisar las opciones en la primera página del manual.

__Paso 3: Vea la lista de palabras disponibles__<br>
Kali viene con varias listas de palabras integradas. Hashcat necesita usar una lista de palabras para descifrar los valores hash.<br>
- Para ver las listas de palabras integradas ingrese el comando ``ls -lh /usr/share/wordlists/``.

```bash
    ┌──(kali㉿Kali)-[~]
    └─$ ls -lh /usr/share/wordlists/
```

Aquí se enumeran las listas de palabras que se distribuyen con Kali. Utilizaremos la lista de palabras __rockyou.txt__. La lista de palabras rockyou.txt es un diccionario de contraseñas que contiene más de 14 millones de contraseñas.<br>
- Cambie el directorio a /usr/share/wordlists ingresando el comando:

```bash
    ┌──(kali㉿Kali)-[~]
    └─$ cd /usr/share/wordlists
```

Extraiga el archivo rockyou.txt.gz con el comando __gzip__:

```bash
    ┌──(kali㉿Kali)-[/usr/share/wordlists]
    └─$ sudo gzip -d rockyou.txt.gz
```

Enumere el contenido del directorio con el comando __ls__. Verifique el archivo rockyou.txt esté descomprimido.<br>

```bash
    ┌──(kali㉿Kali)-[/usr/share/wordlists]
    └─$ ls
```
Utilice el comando __more__, seguido del nombre del archivo para ver el contenido del archivo y ver algunas contraseñas que utilizará hashcat para descifrar los hashes.<br>

```bash
    ┌──(kali㉿Kali)-[/usr/share/wordlists]
    └─$ more rockyou.txt
```

Las listas de palabras para descifrar hashes o forzar inicios de sesión a menudo se recopilan de volcados de contraseñas que divulgan públicamente información robada de cuentas de usuarios. Desplácese por la salida para tener una idea del contenido del archivo.<br>
- Presione __q__ o __Ctrl + Z__ para salir del contenido del archivo.<br>
- Regrese al directorio de inicio:

```bash
    ┌──(kali㉿Kali)-[/usr/share/wordlists]
    └─$ cd /home/kali
```
__Paso 4: Descifre los hash con Hashcat__<br>
Para descifrar los hash contenidos en el archivo my_pw_hashes.txt, use el siguiente comando:

```bash
    ┌──(kali㉿Kali)-[~]
    └─$ sudo hashcat -m 0 -a 0 -o cracked.txt my_pw_hashes.txt /usr/share/wordlists/rockyou.txt
```

Este comando genera las contraseñas descifradas en el nuevo archivo cracked.txt.<br>
Para ver el contenido del archivo cracked.txt y la contraseña de texto sin formato, ingrese el comando:

```bash
    ┌──(kali㉿Kali)-[~]
    └─$ sudo cat cracked.txt
```

## Parte 3: Descubrir hashes con John the Ripper mediante ataques de diccionario y fuerza bruta
__Paso 1: Ver el archivo de ayuda de John the Ripper__<br>
En una ventana de terminal, introduzca el comando: __john -h__ para ver el archivo de ayuda de John the Ripper.<br>

```bash
    ┌──(kali㉿Kali)-[~]
    └─$ john -h
```

__Paso 2: Descifre los valores hash con John the Ripper__<br>
Utilice el siguiente comando para descifrar los hashes en el archivo **my_pw_hashes.txt**. Esto puede llevar algún tiempo.<br>

```bash
    ┌──(kali㉿Kali)-[~]
    └─$ john --format=raw-md5 my_pw_hashes.txt
```

En este caso, John usa una lista mínima de palabras de contraseñas de manera predeterminada para descifrar rápidamente las contraseñas comunes.<br>
Si deja que John continúe ejecutándose el tiempo suficiente, eventualmente descifrará las contraseñas restantes. (Tenga en cuenta que esto puede demorar entre 10 y 20 minutos). Presione __Ctrl + C__ o __q__ para cancelar en cualquier momento después de haber descifrado algunas contraseñas, si lo desea.<br>

__Paso 3: Use listas de palabras más grandes__<br>
La lista de palabras predeterminada para John the Ripper es bastante pequeña. John puede usar otras listas de palabras, como rockyou.txt. También es posible descargar listas de palabras adicionales de Internet.<br>
Utilice el siguiente comando para indicarle a John the Ripper que utilice la lista de palabras rockyou.txt<br>

```bash
    ┌──(kali㉿Kali)-[~]
    └─$ john --wordlist=/usr/share/wordlists/rockyou.txt --format=raw-md5 my_pw_hashes.txt
```

__Paso 4: Utilice la fuerza bruta__<br>
Para indicar a John que use solo el descifrado por fuerza bruta, use el siguiente comando:<br>

```bash
    ┌──(kali㉿Kali)-[~]
    └─$ john --incremental my_pw_hashes.txt
```

Tenga en cuenta que el uso de la fuerza bruta puede llevar mucho tiempo para descifrar los hash de contraseña. Una GPU potente puede tardar muchas horas en descifrar una contraseña compleja de 8 caracteres.<br>
MD5 se considera demasiado débil para usar. Sin embargo, observe cuánto tiempo lleva descifrar incluso un hash MD5 mediante la fuerza bruta. Cancele el proceso con __Ctrl + C__ o __q__.<br>

__Paso 5: Muestre sus contraseñas descifradas__<br>
En este ejemplo, si interrumpió el proceso de descifrado de contraseñas con John y el formato RAW-MD5, aún puede revisar las contraseñas descifradas con la opción ``--show``.

```bash
    ┌──(kali㉿Kali)-[~]
    └─$ john --show --format=raw-md5 my_pw_hashes.txt
```

__Paso 6: Experimente__<br>
Si tiene tiempo, pruebe algunas contraseñas complejas de diferentes longitudes de 4 a 8 caracteres. Intente descifrar por fuerza bruta las contraseñas con John the Ripper en modo incremental. Cree un archivo que contenga hashes de contraseñas y luego ejecute la herramienta.<br>

## Parte 4: Descifre los valores hash con RainbowCrack y tablas arcoíris
Las tablas arcoíris son archivos comunes que pueden crearse con RainbowCrack o descargarse de Internet. La creación de una tabla arcoíris puede llevar una cantidad considerable de tiempo y espacio de almacenamiento, ya que son muy grandes, con un tamaño que va desde los 20 GB hasta más de 1 TB.<br>
- Cree una pequeña tabla arcoíris simple que descifre contraseñas MD5 de hasta 3 caracteres con solo letras minúsculas.<br>
El programa __rtgen__ se utiliza para general tablas arcoíris en función de los parámetros especificados por el usuario.<br>
- Introduzca el comando __rtgen -h__ y revise las opciones.<br> Las tablas arcoíris de ejemplo se proporcionan en la parte inferior del resultado.
- Cree una tabla arcoíris ingresando:

```bash
    ┌──(kali㉿Kali)-[~]
    └─$ sudo rtgen md5 loweralpha 1 3 0 1000 1000 0
```

Este comando crea una tabla arcoíris que puede descifrar contraseñas de tres caracteres y solo letras minúsculas. La aplicación creó un archivo con 1000 entradas. La creación de tablas arcoíris más complejas puede llevar mucho tiempo y consumir muchos recursos.<br>
- Verifique que se haya creado la tabla arcoíris. Muestre el contenido del directorio rainbowcrack ingresando el comando:<br>

```bash
    ┌──(kali㉿Kali)-[~]
    └─$ cd /usr/share/rainbowcrack
    ┌──(kali㉿Kali)-[/usr/share/rainbowcrack]
    └─$ ls
```
La tabla arcoíris recién creada debe estar en el directorio como un archivo __.rt__.<br>

__Paso 3: Ordene la tabla arcoíris__<br>
- A continuación se debe ordenar la tabla arcoíris. Ingrese el comando ``sudo rtsort .`` en el indicador.<br>

```bash
    ┌──(kali㉿Kali)-[/usr/share/rainbowcrack]
    └─$ sudo rtsort .
```
Genere un hash para una contraseña simple de 3 caracteres que luego pueda descifrarse. Ingrese el siguiente comando:

```bash
    ┌──(kali㉿Kali)-[/usr/share/rainbowcrack]
    └─$ echo -n 'dog' | md5sum | awk '{print $1}'
    06d80eb0c50b49a509b49f2424e8c805
```

Descifre el hash con la tabla arcoíris usando RainbowCrack. En el indicador ingrese el comando ``rcrack . -h 06d80eb0c50b49a509b49f2424e8c805``.

```bash
    ┌──(kali㉿Kali)-[/usr/share/rainbowcrack]
    └─$ rcrack . -h 06d80eb0c50b49a509b492424e8c805
```

En milisegundos, RainbowCrack debería descifrar el hash y revelar la contraseña.<br>
- También puede descifrar los hash contenidos en un archivo .txt. Para crear un archivo .txt con algunos hash, ingrese los siguientes comandos en el indicador:<br>

```bash
    echo -n 'fox' | md5sum | awk '{print $1}' > ~/my_rainbow_hashes.txt
    echo -n 'boo' | md5sum | awk '{print $1}' >> ~/my_rainbow_hashes.txt
    echo -n 'pop' | md5sum | awk '{print $1}' >> ~/my_rainbow_hashes.txt
```

Para descifrar los hashes en el archivo, ingrese el comando ``rcrack . -l ~/my_rainbow_hashes.txt`` en el indicador. La opción ``-l`` le dice a rcrack que use un archivo de lista de hash como entrada.<br>

```bash
    ┌──(kali㉿Kali)-[/usr/share/rainbowcrack]
    └─$ rcrack . -l ~/my_rainbow_hashes.txt
```

__Paso 4: Explore recursos para descargar las tablas arcoíris__<br>
Además de generar tablas arcoíris con el comando ``rtgen``, hay muchos recursos en Internet para descargar tablas arcoíris.<br>Abra un navegador web y busque __descargar tablas arcoíris__.<br>