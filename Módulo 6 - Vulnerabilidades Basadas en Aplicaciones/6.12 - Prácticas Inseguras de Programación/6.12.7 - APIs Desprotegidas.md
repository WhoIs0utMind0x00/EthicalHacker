# 6.12.7 - APIs Desprotegidas
Hoy en día, las interfaces de programación de aplicaciones (API) se utilizan en todas partes. Una gran cantidad de aplicaciones modernas utilizadas APIs para permitir que otros sistemas interactúen con la aplicación. Desafortunadamente, muchas APIs carecen de controles adecuados y son difíciles de monitorear. La amplitud y la complejidad de las API también dificultan la automatización de pruebas de seguridad efectivas. Existen algunos métodos o tecnologías detrás de las API modernas:<br>
- __Protocolo Simple de Acceso a Objetos (SOAP)__: Este protocolo de acceso a servicios web basado en estándares fue desarrollado originalmente por Microsoft y ha sido utilizado por numerosas aplicaciones antiguas durante muchos años. [SOAP](https://www.w3.org/TR/soap) utiliza XML exclusivamente para proporcionar servicios de API. Las especificaciones basadas en XML se rigen por documentos de Definición de Esquema XML (XSD). SOAP se creó originalmente para reemplazar soluciones antiguas, como el Modelo de Objetos Componentes Distribuidos (DCOM) y la Arquitectura de Agente de Solicitud de Objetos Comunes (CORBA).
- __Transferencia de Estado Representacional (REST)__: Este estándar de API es más fácil de usar que SOAP. Utiliza JSON en lugar de XML y estándares como Swagger y la especificación [OpenAPI](https://www.openapis.org) para facilitar la documentación y fomentar la adopción.
- __GraphQL__: [GraphQL](https://graphql.org/code) es un lenguaje de consulta para API que proporciona muchas herramientas para desarrolladores. GraphQL ahora se usa para muchas aplicaciones móviles y tableros en línea. Muchos lenguajes diferentes admiten GraphQL.<br>
__NOTA__: SOAP y REST utilizan el protocolo HTTP. Sin embargo, SOAP se limita a un conjunto más estricto de patrones de mensajería de API que REST. Como mejor práctica, siempre debe usar el Protocolo de Transferencia de Hipertexto Seguro (HTTPS), que es la versión segura de HTTP. HTTPS utiliza cifrado sobre el protocolo de seguridad de la capa de transporte (TLS) para proteger los datos confidenciales.<br>

Una API a menudo proporciona un plan que describe la implementación subyacente de una aplicación. Esta hoja de ruta puede brindar a los evaluadores de penetración pistas valiosas sobre los vectores de ataque que, de otro modo, podrían pasar por alto. La documentación de la API puede proporcionar un gran nivel de detalle que puede ser muy valioso para un evaluador de penetración. La documentación de la API puede incluir lo siguiente:<br>
- __Swagger (OpenAPI)__: [Swagger](https://swagger.io) es un marco moderno de documentación y desarrollo de API que es la base de la Especificación de OpenAPI (OAS).
- __Documentos de Lenguaje de Descripción de Servicios Web (WSDL)__: [WSDL](https://www.w3.org/TR/wsdl20-primer) es un lenguaje basado en XML que se utiliza para documentar la funcionalidad de un servicio web.
- __Documentos de Lenguaje de Descripción de Aplicaciones Web (WADL)__: [WADL](https://www.w3.org/Submission/wadl) es un lenguaje basado en XML para describir aplicaciones web.<br>

Al realizar pruebas de penetración en una API, es importante recopilar solicitudes completas mediante un proxy como __OWASP ZAP__ o __BurpSuite__. Es importante asegurarse de que el proxy pueda recopilar solicitudes de API completas y no solo URL porque REST, SOAP y otros servicios de API usan más que solo parámetros __GET__.<br>
Cuando analice las solicitudes recopiladas, busque parámetros no estándar y encabezados HTTP anormales. También debe determinar si un segmento de URL tiene un patrón que se repite en otras URL. Estos patrones pueden incluir un número o una ID, fechas y otra información valiosa. Inspeccione los resultados y busque valores de parámetros estructurados en JSON, XML o incluso estructuras no estándar.<br>

__CONSEJO__: Si observa que un segmento de URL tiene muchos valores, puede ser porque es un parámetro y no una carpeta o un directorio en el servidor web. Por ejemplo, si la URL `http://web.h4cker.org/s/abcd/page` se repite con diferentes valores para `abcd` (como `http://web.h4cker.org/dead/page` o `http://web.h4cker.org/beef/page`), esos valores cambiantes son definitivamente parámetros de la API.<br>

También puede usar fuzzing para encontrar vulnerabilidades del API (o vulnerabilidades en cualquier aplicación o sistema). Según OWASP, el __fuzz testing__ o __fuzzing__ es una técnica de prueba de software en un entorno desconocido o caja negra, que básicamente consiste en encontrar errores de implementación utilizando la inyección automática de datos malformados o semimalformados.<br>
__NOTA__: Consulte la página de OWASP sobre el [Fuzzing](https://www.owasp.org/index.php/Fuzzing) para conocer los diferentes tipos de técnicas de fuzzing para usar con protocolos, aplicaciones y otros sistemas.<br>

Al probar las API, siempre debe analizar las solicitudes recopiladas para optimizar el fuzzing. Después de encontrar los posibles parámetros para fuzz, determine los valores válidos y no válidos que desea enviar a la aplicación. Por supuesto, el fuzzing debe centrarse en los valores no válidos (por ejemplo, enviar un __GET__ o __PUT__ con valores grandes o caracteres especiales, Unicode, etc.).<br>
__NOTA__: OWASP tiene una [Hoja de Referencia de Seguridad de REST](https://cheatsheetseries.owasp.org/cheatsheets/REST_Security_Cheat_Sheet.html) que proporciona numerosos procedimientos recomendados sobre como proteger las API de RESTful (REST).<br>
A continuación, se presentan varios procedimientos recomendados y recomendaciones para proteger las API:<br>

- Asegure los servicios de API para proporcionar dispositivos finales HTTPS con solo una versión robusta de TLS.
- Valide los parámetros en la aplicación y sanitice los datos entrantes de los clientes de la API.
- Escanee explícitamente en busca de firmas de ataques comunes; los ataques de inyección a menudo se delatan al seguir patrones comunes.
- Utilice estándares de autenticación y autorización sólidos.
- Utilice bibliotecas confiables y estándar para crear las API.
- Segmente la implementación de la API y la seguridad de la API en capas distintas; al hacerlo, permite que el desarrollador de la API se concentre completamente en el dominio de la aplicación.
- Identifique qué datos deben estar disponibles públicamente y qué información es confidencial.
- Si es posible, solicite a un experto en seguridad que verifique el código API.
- Haga que la documentación interna de la API sea obligatoria.
- Evite hablar sobre el desarrollo de API de la empresa (o cualquier otro desarrollo de aplicaciones) en foros públicos.<br>
__NOTA__: [CWE-227: Abuso de API](https://cwe.mitre.org/data/definitions/227.html) cubre las API no seguras.<br>