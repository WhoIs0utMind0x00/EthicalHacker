# 6.1.2 - El protocolo HTTP
Veamos algunos hechos y definiciones antes de pasar a los detalles sobre HTTP:
- El protocolo HTTP 1.1 se define en las RFC 7230-7235.
- En los ejemplos de este módulo, cuando hacemos referencia a un _servidor HTTP_, básicamente nos referimos a un servidor web.
- Cuando nos referimos a _clientes HTTP_, estamos hablando de navegadores, proxies, clientes de API y otros programas de clientes HTTP personalizados.
- HTTP es un protocolo muy simple, lo cual es bueno y malo.
- En la mayoría de los casos, HTTP se clasifica como un protocolo sin estado que no depende de una conexión persistente para la lógica de comunicación. 
- Una transacción HTTP consiste en una única solicitud de un cliente a un servidor, seguida de una única respuesta del servidor al cliente.
- HTTP es diferente de los protocolos con estado, como FTP, SMTP, IMAP y POP. Cuando un protocolo tiene estado, las secuencias de comandos relacionados se tratan como una única interacción.
- Un servidor debe mantener el estado de su interacción con el cliente durante la transmisión de comandos sucesivos hasta que finalice la interacción.
- Una secuencia de comandos transmitidos y ejecutados a menudo se denomina _sesión_.<br>

_Un cliente web, un proxy y un servidor web (HTTP)_<br>

<img src="img/http.jpeg" width="75%" height="75%" style="border-radius:10px;"><br>

Los proxies HTTP actúan como servidores y clientes. Los proxies realizan solicitudes a los servidores web en nombre de otros clientes. Permiten las transferencias HTTP a través de firewalls y también pueden proporcionar soporte para el almacenamiento en caché de mensajes HTTP. Los proxies pueden realizar otros roles en entornos complejos, incluida la traducción de direcciones de red (NAT) y el filtrado de solicitudes HTTP.<br>
HTTP es un protocolo de nivel de aplicación en el conjunto de protocolos TCP/IP y utiliza TCP como protocolo de capa de transporte subyacente para transmitir mensajes. HTTP utiliza un modelo de solicitud/respuesta, lo que básicamente significa que un programa cliente HTTP envía un mensaje de solicitud HTTP a un servidor y, a continuación, el servidor devuelve un mensaje de respuesta HTTP.<br>

_Modelo de Solicitud/Respuesta HTTP_<br>

<img src="img/solicitud_respuesta.jpeg" width="75%" height="75%" style="border-radius:10px;"><br>

La utilidad (comando) de Linux __tcpdump__ se utiliza para capturar los paquetes del cliente (192.168.78.6) al servidor web para acceder al sitio web _http://web.h4cker.org/omar.html_.<br>

_Captura de paquetes de una Solicitud y Respuesta HTTP mediante **tcpdump**_<br>

```bash
omar@jorel:~$ sudo tcpdump net 185.199.0.0/16
tcpdump: verbose output suppressed, use -v or -vv for full protocol
decode
listening on enp9s0, link-type EN10MB (Ethernet), capture size 262144
bytes

23:55:13.076301 IP 192.168.78.6.37328 > 185.199.109.153.http: Flags
[S], seq 3575866614, win 29200, options [mss 1460,sackOK,TS val
462864607 ecr 0,nop,wscale 7], length 0

23:55:13.091262 IP 185.199.109.153.http > 192.168.78.6.37328: Flags
[S.], seq 3039448681, ack 3575866615, win 26960, options [mss
1360,sackOK,TS val 491992242 ecr 462864607,nop,wscale 9], length 0

23:55:13.091322 IP 192.168.78.6.37328 > 185.199.109.153.http: Flags
[.], ack 1, win 229, options [nop,nop,TS val 462864611 ecr 491992242],
length 0

23:55:13.091409 IP 192.168.78.6.37328 > 185.199.109.153.http: Flags
[P.], seq 1:79, ack 1, win 229, options [nop,nop,TS val 462864611 ecr
491992242], length 78: HTTP: GET / HTTP/1.1

23:55:13.105791 IP 185.199.109.153.http > 192.168.78.6.37328: Flags
[.], ack 79, win 53, options [nop,nop,TS val 491992246 ecr 462864611],
length 0

23:55:13.106727 IP 185.199.109.153.http > 192.168.78.6.37328: Flags
[P.], seq 1:6404, ack 79, win 53, options [nop,nop,TS val 491992246
ecr 462864611], length 6403: HTTP: HTTP/1.1 200 OK

23:55:13.106776 IP 192.168.78.6.37328 > 185.199.109.153.http: Flags
[.], ack 6404, win 329, options [nop,nop,TS val 462864615 ecr
491992246], length 0
```
El cliente y el servidor primero completan el protocolo de enlace de tres vías de TCP (SYN, SYN ACK, ACK). Luego el cliente envía un HTTP GET (solicitud) y el servidor responde con un TCP ACK y el contenido de la página (con una respuesta HTTP 200 OK). Cada uno de estos mensajes de solicitud y respuesta contiene un encabezado y un cuerpo del mensaje. Un mensaje HTTP (una solicitud o una respuesta) tiene una estructura que consta de un bloque de líneas que comprende el encabezado del mensaje, seguido del cuerpo del mensaje.<br>

_Detalles de la solicitud HTTP_<br>

<img src="img/solicitud_http.jpeg" width="75%" height="75%" style="border-radius:10px;"><br>

Cuando los navegadores y servidores HTTP se comunican entre sí, realizan interacciones basadas en los encabezados y en el contenido del cuerpo. La solicitud HTTP mostrada tiene la siguiente estructura:
- __El método__: El método es HTTP GET, aunque podría ser cualquiera de los siguientes:
  - __GET__: Recupera información del servidor.
  - __HEAD__: Básicamente lo mismo que __GET__ pero devuelve solo los encabezados HTTP y no el cuerpo del documento.
  - __POST__: Envía datos al servidor (normalmente mediante formularios HTML, solicitudes de API, etc.).
  - __TRACE__: Realiza una prueba de bucle invertido del mensaje a lo largo de la ruta al recurso de destino.
  - __PUT__: Carga una representación del URL especificado.
  - __DELETE__: Elimina el recurso especificado.
  - __OPTIONS__: Devuelve los métodos HTTP que admite el servidor.
  - __CONNECT__: Convierte la conexión de solicitud en un túnel TCP/IP transparente.
- __El URL y el campo de ruta al recurso__: Esto representa la parte de la ruta de la URL solicitada.
- __El campo de número de versión de la solicitud__: Esto especifica la versión de HTTP utilizada por el cliente.
- __El user agent__: En este ejemplo, se utilizó Chrome para acceder al sitio web. En la captura de paquetes, verá lo siguiente<br>
```
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_4) AppleWebKit/537.36 (KHTML, like Gecko)
Chrome/66.0.3359.181 Safari/537.36
```
- __También aparecen varios otros campos: accept, accept-language, accept encoding__ y otros campos.<br>

El servidor después de recibir esta solicitud, genera una respuesta.<br>

_Detalles de la Respuesta HTTP_<br>

<img src="img/respuesta_http.jpeg" width="75%" height="75%" style="border-radius:10px;"><br>

La respuesta del servidor incluye un código de estado de tres dígitos y una breve explicación legible del código de estado. Debajo puede ver los datos de texto (que es el código HTML que proviene del servidor y muestra el contenido del sitio web).<br>

Los mensajes de código de estado HTTP pueden estar en los siguientes rangos:
  -  Los mensajes en el rango 100 son informativos.
  -  Los mensajes en el rango 200 están relacionados con transacciones exitosas.
  -  Los mensajes en el rango 300 están relacionados con las redirecciones HTTP.
  -  Los mensajes en el rango 400 están relacionados con errores del cliente.
  -  Los mensajes en el rango 500 están relacionados con errores del servidor.

### Estructura de URL HTTP
Considere la URL _https://theartofhacking.org:8123/dir/test;id=89?name=omar&x=true_. Desglosemos esta URL en sus partes:
  - __Esquema__: Es la parte de la URL que designa el protoclo subyacente que se utilizará (por ejemplo, HTTP, FTP); le siguen dos puntos y dos barras diagonales (//). En este ejemplo, el esquema es __http__.
  - __Host__: Es la dirección IP (numérica o basada en DNS) del servidor web al que se accede; generalmente sigue a los dos puntos y dos barras diagonales. En este caso, el host es __theartofhacking.org__.
  - __Port__: Esta parte opcional de la URL designa el número de puerto que escucha el servidor web de destino. (El número de puerto predeterminado para los servidores HTTP es 80, pero algunas configuraciones están configuradas para usar un número de puerto alternativo). En este caso, el servidor está configurado para utilizar el puerto __8123__.
  - __Ruta (Path)__: Es la ruta desde el directorio "raíz" del servidor al recurso deseado. En este caso, puede ver que hay un directorio llamado __dir__. (Tenga en cuenta que los servidores web pueden usar alias para apuntar a documentos, puertas de enlace y servicios a los que no se puede acceder explícitamente desde el directorio raíz del servidor).
  - __Path-segment-params__: Esta es la parte la URL que incluye pares de nombre/valor opcionales (es decir, parámetros de segmento de ruta). Un parámetro de segmento de ruta suele estar precedido por un punto y coma (según el lenguaje de programación utilizado) e inmediatamente después de la información de la ruta. Además, vale la pena mencionar que estos parámetros son diferentes de los parámetros de query-string.
  - __query string__: Esta parte opcional de la URL contiene pares de nombre/valor oue representan los parámetros dinámicos asociados con la solicitud. Estos parámetros se incluyen comúnmente en enlaces con fines de seguimiento y configuración de contexto. También pueden producirse a partir de variables en formularios HTML. Por lo general, el query string está precedido por un signo de interrogación. Los signos de igual (=) separan los nombres y los valores, y los símbolos de unión (&) marcan los límites entre los pares de nombre/valor.<br>

Además, otros protocolos, como HTML y CSS, se utilizan en cosas como el Protocolo Simple de Acceso a Objetos (SOAP) y las API de RESTful. Los ejemplos incluyen JSON, XML y el Servicio de Procesamiento Web (WPS).<br>
Las versiones HTTP actuales son 1.1 y 2.0<br>

_Intercambio HTTP 1.1_<br>

<img src="img/protocolo_1.1.jpeg" width="75%" height="75%" style="border-radius:10px;"><br>

_Multiplexación HTTP 2.0_<br>

<img src="img/protocolo_2.0.jpeg" width="75%" height="75%" style="border-radius:10px;"><br>
