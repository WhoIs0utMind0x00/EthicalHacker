# 6.1.6 - Práctica de Laboratorio: Uso del Escáner de Vulnerabilidades GVM

## Objetivos
En esta práctica de laboratorio, se cumplirán los siguientes objetivos:
- Parte 1: Analizar un host en busca de vulnerabilidades
- Parte 2: Explotar una vulnerabilidad detectada por GVM

## Trasfondo / Escenario
GVM es parte del conjunto de productos de Administración de Vulnerabilidades de Código Abierto producido por Greenbone Networks GmbH. El escáner GVM es uno de los escáneres de vulnerabilidades de código abierto más utilizados. A diferencia de Nmap, GVM utiliza una interfaz gráfica de usuario para iniciar escaneos e informar los resultados del escaneo de vulnerabilidades. En esta práctica de laboratorio, analizará un host vulnerable conocido, Metasploitable, y luego determinará cómo formular ataques para explotar las vulnerabilidades.

## Recursos necesarios
- Máquina Virtual Kali
- Acceso a Internet

## Parte 1: Analizar un host en busca de vulnerabilidades
__Paso 1: Iniciar los servicios de GVM__<br>
- Inicie el escáner GVM con el comando __sudo gvm-start__.
```bash
┌──(kali㉿Kali)-[~]
└─$ sudo gvm-start
```
__Nota__: Es posible que reciba el mensaje _"Los servicios de GVM ya se están ejecutando"_. Si el navegador no se abre automáticamente, inícielo manualmente y vaya a _https://127.0.0.1:9392_. Aparecerá la pantalla de inicio de sesión de Greenbone Security Assistant en el navegador.<br>

- En el cuadro de inicio de sesión de Greenbone Security Assistant, ingrese __admin__ como nombre de usuario y __kali__ como contraseña.<br>

__Paso 2: Escanear un host__<br>
En este paso, escaneará el host vulnerable Metasploitable con el escáner de GVM. Este análisis puede llevar algún tiempo, así que esté preparado para esperar al menos 20 minutos o más hasta que finalice.<br>
- La GUI de la aplicación GVM Scanner debe abrirse en el navegador. Seleccione __Scans > Tasks__ en la barra de menús. En la parte superior izquierda de la ventana __Tasks__ aparecen tres íconos. Seleccione el ícono __Task Wizard__ que parece una varita mágica. Elija __Advanced Task Wizard__ en el menú desplegable.<br>
- En la ventana del Advanced Task Wizard, introduzca __Metasploitable__ como nombre del análisis, en el campo __Target Host__, ingrese la dirección IP de Metasploitable, __172.17.0.2__. Deje el resto de la configuración sin cambios y haga clic en __Create__ para crear la tarea e iniciar el análisis.
- La ventana Task indica que la tarea se está ejecutando. En la parte inferior de la ventana, aparece la tarea Metasploitable y la barra de estado muestra el porcentaje completado. Espere hasta que el estado muestre __Listo (100% completado)__. Esto puede demorar 30 minutos o más.
- Haga clic en el número 1 en la columna __Reports__ de la fila Metasploitable, junto al indicador de estado. La lista de informes se abre con una entrada para el día y la hora actuales y la tarea denominada Metasploitable.<br>

__El escaneo encontró 21 vulnerabilidades de alta severidad__.<br>

- Abre el informe haciendo clic en el enlace de fecha y hora en la columna de __Fecha__. Se abre la ventana del informe. Hay once pestañas que muestran varios resultados encontrados durante el análisis. Haga clic en la pestaña __Results__. Las vulnerabilidades encontradas se enumeran en orden de gravedad, algunas son: <br>
  - Múltiples Vulnerabilidades de Ejecución de Código en Distributed Ruby
  - Servicio _rexec_ está en ejecución
  - Vulnerabilidades de XSS
  - Ejecución de comandos en TWiki
  - Fin de vida del sistema operativo
  - Posible puerta trasera en Ingreslock
Entre otros.<br>

- Para obtener más información sobre una vulnerabilidad, haga clic en ella. GVM tiene explicaciones para las vulnerabilidades que encuentra, por ejemplo, TWiki es una plataforma de aplicaciones web y wikis empresariales de código abierto. La vulnerabilidad está presente en versiones anteriores a la 4.2.4 del software. La versión actualizada del software mitigará esa vulnerabilidad.<br>

__Paso 3: Interprete los resultados del análisis__<br>
GVM proporciona una descripción detallada de las vulnerabilidades, incluidos los métodos para mitigar cada vulnerabilidad.<br>
- Haga clic en la vulnerabilidad __The rexec service is running__ que aparece en la pestaña _Results_. GVM proporciona un resumen de los resultados y detalles adicionales. La sección _Insight_ explica un poco sobre la vulnerabilidad y la sección _Solution_ ofrece sugerencias de mitigación.
- Como en _rexec_, que nos dice que es un servicio de acceso remoto que permite a los hosts remotos acceder a un sistema y ejecutar comandos. Y, como la mitigación sugerida, aconseja desactivar el servicio rexec y utilizar alternativas como SSH.<br>
- Haciendo clic en la CVE asociada con la vulnerabilidad rexec, se abre una breve descripción de la CVE.
- Su calificación de complejidad de acceso CVSS es baja, lo que significa que es fácil explotar esta vulnerabilidad.<br>
- Puede obtener información adicional sobre la Prueba de Vulnerabilidad de Red (NVT) que descubrió esta CVE haciendo clic en NVT en la parte inferior de la ventana CVE. Un NVT es un script que se puede ejecutar para verificar vulnerabilidades espcíficas, incluidas las CVE.<br>
- Haga clic en la flecha hacia atrás en el navegador para volver a la pantalla del informe. Los servicios rexec generalmente se ejecutan en los puertos TCP 512, 513 0 514.<br>
- Puede seleccionar la pestaña _Ports_ para ver los puertos abiertos en el sistema Metasploitable.<br>

## Parte 2: Explotar una vulnerabilidad detectada por GVM
Después de descubrir una vulnerabilidad con el escáner de GVM, es posible formular una estrategia de ataque para explotarla. Descubrió e investigó una vulnerabilidad de rexec. En esta parte, formulará una estrategia de ataque y realizará un ataque contra el objetivo.<br>

__Paso 1: Realice el reconocimiento del objetivo__<br>
Los administradores y otros usuarios a menudo reutilizan las contraseñas, usan contraseñas débiles o no pueden cambiar las credenciales predeterminadas de un servicio. Utilizaremos Nmap para ver si podemos aprender algo de SMB sobre las cuentas que podamos usar con rexec.<br>
- Hay varios scripts disponibles para encontrar nombres de usuario válidos con Nmap. Uno de los más comunes es el script del nombre de usuario de SMB. Es una práctica común sincronizar usuarios del sistema operativo con usuarios de SMB (Samba o Windows). Utilice el script de Nmap __smb-brute__ para encontrar usuarios e intentar forzar las contraseñas.<br>
```bash
┌──(kali㉿Kali)-[~]
└─$ sudo nmap -sV -p 445 -script smb-brute 172.17.0.2
```
- Busque la sección __Host script results__ en la salida del comando. Las combinaciones de nombre de usuario y contraseña que se descubrieron con el script de Nmap se enumeran en esta sección.<br>
- Se encontraron msfadmin/msfadmin y user/user como nombres de usuario y su contraseña.<br>

__Paso 2: Realizar el exploit de rexec__<br>
- Para acceder al objetivo de Metasploitable para explotar la vulnerabilidad rexec, necesitará un cliente de shell remoto. Utilice apt-get para instalar un cliente de shell remoto (RSH).<br>
```bash
┌──(kali㉿Kali)-[~]
└─$ sudo apt-get install rsh-client
```
- Intente iniciar sesión en el destino de Metasploitable con el nombre de usuario __msfadmin__ mediante __RSH__. La sintaxis del comando __rsh__ es _rsh -l [nombre de usuario][IP o nombre de host de destino]_<br>
```bash
┌──(kali㉿Kali)-[~]
└─$ rsh -l msfadmin 172.17.0.2
```
- El inicio de sesión es exitoso. El indicador cambia al usuario msfadmin en el equipo remoto. Utilice el comando _pwd_ para determinar el directorio remoto.<br>
```bash
msfadmin@metasploitable:~$ pwd
/home/msfadmin
```
- Intente obtener acceso root a Metasploitable con el comando _sudo su_. Cuando se le solicite una contraseña, introduzca la contraseña __msfadmin__ que descubrió anteriormente.<br>
```bash
msfadmin@metasploitable:~$ sudo su
[sudo] password for msfadmin: msfadmin
root@metasploitable:/home/msfadmin#
```
- En este punto, tiene acceso raíz completo a la computadora de destino y puede ejecutar comandos, cargar o descargar archivos, o agregar usuarios.
- Una vez que tenemos el acceso con privilegios, podemos obtener otros nombres de usuario y contraseñas que no son usuarios de SMB en el sistema copiando los archivos _/etc/passwd_ y _/etc/shadow_ para obtener los nombres de usuario y las contraseñas con hash (cifradas).
- Para obtener las credenciales de los usuarios, podemos utilizar __Unshadow__ y __John the Ripper__. Unshadow puede combinar los dos archivos y John the Ripper puede utilizar el archivo resultante para encontrar las contraseñas de texto sin formato.<br>