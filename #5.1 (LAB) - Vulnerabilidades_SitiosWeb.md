# Práctica de laboratorio - Análisis de Vulnerabilidades de Sitios Web

## Objetivos
En esta práctica de laboratorio se cumplirán los siguientes objetivos:
- Parte 1: Iniciar Nikto y realizar un escaneo básico
- Parte 2: Usar Nikto para escanear varios servidores web
- Parte 3: Investigar las vulnerabilidades de los sitios web
- Parte 4: Exportar los resultados de Nikto a un archivo

## Trasfondo / Escenario
Nikto es un escáner de vulnerabilidades web popular que puede encontrar vulnerabilidades de inyección SQL, XSS y otras vulnerabilidades comunes en sitios web. Puede identificar el software instalado mediante encabezados de página y archivos. Nikto admite los protocolos HTTP y HTTPS.<br>

## Recursos necesarios
- Máquina Virtual Kali
- Acceso a Internet

## Parte 1: Iniciar Nikto y realizar un escaneo básico
__Paso 1: Iniciar Nikto en Kali Linux__<br>
- Nikto está preinstalado en Kali Linux. Es una herramienta de línea de comandos que se puede iniciar mediante la opción __Application > Vulnerability Analysis > nikto__ en el menú, o directamente desde la línea de comandos. Para ver el archivo de ayuda, use el comando __nikto --help__.<br>
```bash
┌──(kali㉿Kali)-[~]
└─$ nikto --help
```
La opción de comando __-Tuning+9__ descubrirá solo las vulnerabilidades de inyección SQL.<br>

__Paso 2: Realice un análisis básico en scanme.nmap.org__<br>
- _Nmap.org_ tiene un sitio web configurado para probar los escaneos de Nmap. Utilizará este servidor web para realizar su primer análisis de vulnerabilidades. Inicie Firefox y vaya al sitio web _https://scanme.nmap.org_.
- Las limitaciones que Nmap.org sugiere para el uso de su servidor son:
  - Menos de 100 escaneos.
  - Sin herramientas de descifrado de contraseñas SSH de fuerza bruta.
<br>

- Utilice Nikto para realizar un escaneo básico en el sitio web _scanme.nmap.org_.
```bash
┌──(kali㉿Kali)-[~]
└─$ nikto -h scanme.nmap.org
```
__Nota__: Los escaneos de Nikto en un servidor de Internet pueden demorar unos minutos. Espere hasta que vuelva el indicador de la CLI para continuar con los siguientes pasos. Para finalizar un análisis en ejecución, introduzca __CTRL + C__.<br>
Debe recibir una salida similar a la siguiente:
```bash
- Nikto v2.5.0
---------------------------------------------------------------------------
+ Multiple IPs found: 45.33.32.156, 2600:3c01::f03c:91ff:fe18:bb2f
+ Target IP:          45.33.32.156
+ Target Hostname:    scanme.nmap.org
+ Target Port:        80
+ Start Time:         2023-05-23 05:48:36 (GMT-7)
---------------------------------------------------------------------------
+ Server: Apache/2.4.7 (Ubuntu)
+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options
+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/
+ No CGI Directories found (use '-C all' to force check all possible dirs)
+ /index: Uncommon header 'tcn' found, with contents: list.
+ /index: Apache mod_negotiation is enabled with MultiViews, which allows attackers to easily brute force file names. The following alternatives for 'index' were found: index.html. See: http://www.wisec.it/sectou.php?id=4698ebdc59d15,https://exchange.xforce.ibmcloud.com/vulnerabilities/8275
+ Apache/2.4.7 appears to be outdated (current is at least Apache/2.4.54). Apache 2.2.34 is the EOL for the 2.x branch.
+ ERROR: Error limit (20) reached for host, giving up. Last error: error reading HTTP response
+ Scan terminated: 20 error(s) and 5 item(s) reported on remote host
+ End Time:           2023-05-23 05:49:14 (GMT-7) (38 seconds)
---------------------------------------------------------------------------
+ 1 host(s) tested
```
- Explore el enlace para la vulnerabilidad encontrada __The X-Content-Type-Options header is not set__. Abra Firefox y vaya al enlace: _https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/_.
- Desplácese hacia abajo para ver el resumen, el impacto, los consejos de correción y los enlaces de clasificación vulnerables.<br>
- La correción recomendada para esta vulnerabilidad es:
  1. Establezca el encabezado content-type para que coincida con el tipo de recurso que se ofrece.
  2. Agregue el encabezado X-Content-Type-Options con un valor de "nosniff" para indicarle al navegador que confíe en el content-type enviado en lugar de rastrear para encontrar el content-type real. Ejemplo: __X-Content-Type-Options: nosniff__.<br>
- Nikto busca servicios web del puerto 80. Para escanear dominios con HTTPS habilitado, debe especificar el indicador __-ssl__ para escanear el puerto 443:
```bash
┌──(kali㉿Kali)-[~]
└─$ nikto -h https://nmap.org -ssl
```

## Parte 2: Uso de Nikto para escanear varios servidores web
En esta parte, utilizará Nikto para escanear servidores en las redes virtuales internas en busca de servidores web vulnerables. Primero creará un archivo de texto para enumerar las direcciones IP que desea escanear. En el reconocimiento de la vida real, puede obtener las direcciones IP de los servidores realizando una búsqueda de DNS del nombre del servidor a partir de la URL.<br>
- Primero, cree un archivo de texto que enumere las direcciones IP de los servidores web que se analizarán. Utilice la aplicación Mousepad integrada en Kali para crear el archivo. Copie y pegue esta lista de direcciones IP en su documento. Guarde el documento en el directorio de inicio como **IP_list.txt**.
```txt
10.6.6.11
10.6.6.13
10.6.6.14
10.6.6.23
172.17.0.2
```
- Ejecute el análisis con el comando **nikto -h IP_list.txt**.
```bash
┌──(kali㉿Kali)-[~]
└─$ nikto -h IP_list.txt
```
__Nota__: Si maximiza la ventana del terminal, la salida será más fácil de leer<br>
En la salida, podemos ver que cuatro objetivos están alojando servidores web y tres de esos servidores están ejecutando Apache.

## Parte 3: Investigue las vulnerabilidades del sitio web
Nikto proporciona información sobre las vulnerabilidades que descubre durante sus análisis. Algunas vulnerabilidades están asociadas con un número de _OSVDB_ (una base de datos de vulnerabilidades de código abierto anterior), una _CWE_ ([Enumeración de Vulnerabilidades Comunes](https://cwe.mitre.org/about/)) o una _CVE_ ([Vulnerabilidades y Exposiciones Comunes](https://cve.mitre.org/)). OSVDB se suspendió en 2016. Puede utilizar la herramienta de referencia CVE para traducir el identificador OSVDB a una entrada CVE para poder investigar más a fondo la vulnerabilidad.<br>
- Revise la información que reportó Nikto para el servidor web 172.17.0.2. Las CVE enumeradas en el resultado son CVE-1999-0678 y CVE-2003-1418. Utilice los enlaces de CVE en el resultado de Nikto para encontrar más información sobre las vulnerabilidades.<br>
La vulnerabilidad __CVE 1999-0678__ hace referencia a la configuración predeterminada en algunas versiones de Apache que establece el ServerRoot en /usr/doc. Esto permite que los usuarios remotos lean los archivos de documentación de todo el servidor.<br>
__CVE-2003-1418__ permite a los atacantes remotos obtener información sensible a través del encabezado ETag o del límite MIME multipart.<br>

- Utilice la Base de Datos Nacional de Vulnerabilidadaes (_https://nvd.nist.gov_) para encontrar información adicional sobre las CVE. En la sección References to Advisories, Solutions, and Tools, siga los enlaces para encontrar las medidaas de correción necesarias para cerrar cada vulnerabilidad.<br>
- Por ejemplo, la solución proporcionada para CVE-2003-1418 dice que existe un parche de código fuente que soluciona este problema.<br>

## Parte 4: Exportar los resultados de Nikto a un archivo
Nikto puede generar los resultados de un escaneo en varios formatos, incluidos CSV, HTML, SQL, txt y XML. Además, Nikto puede emparejarse con Metasploit para lanzar exploits contra las vulnerabilidades que descubra.<br>
- Para exportar el resultado de un análisis, utilice el indicador __-o__ seguido del nombre del archivo. Exporte los resultados de un escaneo a un archivo de informe HTML denominado **scan_results.htm**. El tipo de archivo de salida se determina a partir de la extensión del archivo.<br>
```bash
┌──(kali㉿Kali)-[~]
└─$ nikto -h 172.17.0.2 -o scan_results.htm
```
- Busque el archivo en el directorio /home/kali y ábralo en su navegador para ver el formato del informe.
- Para especificar un formato de salida de archivo de texto que sea independiente de la extensión del archivo, utilice el indicador __-Format__. Utilice la opción __-Format csv__ para guardar el archivo en formato .csv para importarlo a otras aplicaciones de análisis.<br>
```bash
┌──(kali㉿Kali)-[~]
└─$ nikto -h 172.17.0.2 -o scan_results.txt -Format csv
```
- Utilice el comando __cat__ para ver el archivo **scan_results.txt** guardado.<br>