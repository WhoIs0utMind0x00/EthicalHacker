# Ataques de tipo Pass-the-Hash
Todas las versiones de Windows almacenan las contraseñas como hashes en un archivo denominado _Administrador de cuentas de seguridad (SAM)_. El sistema operativo no sabe cuál es la contraseña real porque almacena solo un hash de la contraseña. En lugar de utilizar un algoritmo de hash conocido. Microsoft creó su propia implementación que se ha desarrollado a lo largo de los años.<br>
Microsoft también tiene un conjunto de protocolos de seguridad para la autenticación, denominado New Technology LAN Manager (NTLM). NTLM tenía dos versiones: NTLMv1 y NTLMv2. Desde Windows 2000, Microsoft ha utilizado Kerberos en dominios de Windows. Sin embargo, NTLM aún se puede usar cuando el cliente se autentica en un servidor a través de una dirección IP o si un cliente se autentica en un servidor en un bosque de Active Directory (AD) diferente configurado para la confianza  de NTLM en lugar de una confianza transitiva entre bosques. Además, es posible que NTLM se siga usando si el cliente se autentica en un servidor que no pertenece a un dominio o si la comunicación Kerberos está bloqueada por un cortafuego.<br>
Entonces, __¿Qué es un ataque de transferencia de hash?__ Debido a que los hash de contraseña no se pueden revertir, en lugar de intentar averiguar cuál es la contraseña del usuario, un atacante puede usar un hash de contraseña recopilado de un sistema comprometido y luego usar el mismo hash para iniciar sesión en otro sistema cliente o servidor.<br>
_Ataque de transferencia de hash_<br>

<img src="img/pass_hash.jpeg" width="35%" height="35%" style="border-radius:10px;"><br>

El sistema operativo Windows y las aplicaciones de Windows piden a los usuarios que ingresen sus contraseñas cuando inician sesión. Luego, el sistema convierte las contraseñas en hashes (en la mayoría de los casos, mediante una API llamada LsaLogonUser). Un ataque de transferencia de hash evita este proceso y simplemente envía el hash al sistema para la autenticación.<br>
__CONSEJO__: _Mimikatz_ es una herramienta utilizada por muchos evaluadores de penetración, atacantes e incluso malware que puede ser útil para recuperar hashes de contraseñas de la memoria; es una herramienta posterior a la explotación muy útil. Puede descargar la herramienta desde el [Repositorio Mimikatz](https://github.com/gentilkiwi/mimikatz). Metasploit también incluye Mimikatz como un script de Meterpreter para facilitar la explotación sin la necesidad de cargar ningún archivo al disco del host comprometido. Puede encontrar más información en [Integración de Mimikatz / Metasploit](https://www.offensive-security.com/metasploit-unleashed/mimikatz/).
