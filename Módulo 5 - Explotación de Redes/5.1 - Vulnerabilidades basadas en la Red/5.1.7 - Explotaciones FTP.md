# Explotaciones de FTP
Los atacantes suelen abusar de los servidores FTP para robar información. El protocolo FTP heredado no utiliza cifrado ni realiza ningún tipo de validación de integridad. La práctica recomendada dicta que implemente una alternativa más segura, como SFTP o FTPS.<br>
Los protocolos SFTP y FTPS utilizan cifrado para proteger los datos; sin embargo, algunas implementaciones, como _Blowfish_ y _DES_, ofrecen cifrados débiles (algoritmos de cifrado). Debe utilizar algoritmos más sólidos, como _AES_. De manera similar, los servidores SFTP y FTPS utilizan algoritmos de hash para verificar la integridad de la transmisión de archivos. SFTP usa SSH y FTPS sobr TLS. Las mejores prácticas exigen deshabilitar los protocolos de hash débiles, como MD5 o SHA-1, y usar algoritmos más solidos en la familia SHA-2 (como SHA-2 o SHA-512).<br>
Además los servidores FTP a menudo permiten la autenticación de usuarios anónimos, de la que un atacante puede abusar para almacenar archivos no deseados en su servidor, potencialmente para la exfiltración. Por ejemplo, un atacante pone en riesgo un sistema y extrae información confidencial, puede almacenar esa información en cualquier servidor FTP que pueda estar disponible y permitir que cualquier usuario se conecte mediante una cuenta anónima.<br>
_Uso de Nmap para escanear un servidor FTP_<br>
<!-- nmap -sV 172.16.20.136 -->
```bash
┌──(root㉿Kali)-[~]
└─# nmap -sV 172.16.20.136
Starting Nmap 7.80 ( https://nmap.org ) at 2021-08-05 22:37 EDT
Nmap scan report for 172.16.20.136
Host is up (0.00081s latency).
Not shown: 997 closed ports
PORT STATE SERVICE VERSION
21/tcp open ftp    vsftpd 3.0.3
22/tcp open ssh    OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux;
protocol 2.0)
```
_Verificación de inicio de sesión anónimo de FTP con Metasploit_<br>
<!-- metasploit > use auxiliary/scanner/ftp/anonymous -->
<!-- set RHOSTS 172.16.20.136 > exploit -->
```bash
msf6 > use auxiliary/scanner/ftp/anonymous
msf6 auxiliary(scanner/ftp/anonymous) > set RHOSTS 172.16.20.136
RHOSTS => 172.16.20.136
msf6 auxiliary(scanner/ftp/anonymous) > exploit

[*] 172.16.20.136:21      - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```
La mitigación de este ejemplo es editar el archivo de configuración del servidor FTP para deshabilitar el inicio de sesión anónimo. En este ejemplo, el servidor está usando vsFTPd y, por lo tanto, el archivo de configuración se encuentra en _/etc/vsftpd.conf_. Los siguientes son varios procedimientos recomendados adicionales para mitigar el abuso y los ataques al servidor FTP:

- Utilice contraseñas seguras y autenticación multifactor. Una buena práctica es utilizar una buena administración de credenciales y contraseñas seguras. Cuando sea posible, utilice la autenticación de dos factores para cualquier servicio o servidor crítico.
- Implemente la seguridad de archivos y carpetas, asegurándose que los usuarios tengan acceso a solo los archivos a los que tienen derecho.
- Utilizar el cifrado en reposo, es decir, cifrar todos los archivos almacenados en el servidor FTP.
- Bloquear cuentas de administración. Debe restringir los privilegios de administrador a una cantidad limitada de usuarios y exigirles que utilicen la autenticación de varios factores. Además, no utilice nombres de usuario de administrador comunes como _root_ o _admin_.
- Mantenga actualizado el software del servidor FTPS o SFTP.
- Utilice los cifrados validados FIPS 140-2 del gobierno de EE. UU. para obtener orientación general sobre qué algoritmos de cifrado utilizar.
- Mantenga la base de datos back-end en un servidor diferente al servidor FTP.
- Requerir la reautenticación de las sesiones inactivas.